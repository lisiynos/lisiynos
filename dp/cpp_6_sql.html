<html>
<head>
    <meta http-equiv=Content-Type content="text/html; charset=utf-8">
    <title>SQL (на примере sqlite), QtSql</title>
    <link rel="stylesheet" type="text/css" href="../style/style.css">
    <script type="text/javascript" src="../syntax/sh_main.min.js"></script>
    <script type="text/javascript" src="../syntax/sh_cpp.min.js"></script>
    <script type="text/javascript" src="../syntax/sh_sql.min.js"></script>
    <script type="text/javascript" src="../syntax/load.js"></script>
    <link type="text/css" rel="stylesheet" href="../style/sh_nedit.css">
</head>
<body onLoad="sh_highlightDocument();">
<div id="content">


<h1>Работа с Базами Данных (на примере SQLite)</h1>

<p><strong>Определения из международных стандартов:</strong></p>

<p><strong>База данных</strong> - совокупность данных, хранимых в соответствии со схемой данных, манипулирование
    которыми выполняют в соответствии с правилами средств моделирования данных (из ГОСТ Р ИСО МЭК ТО 10032-2007:
    Эталонная модель управления данными).</p>

<p><strong>База данных</strong> - совокупность данных, организованных в соответствии с концептуальной структурой,
    описывающей характеристики этих данных и взаимоотношения между ними, причём такое собрание данных, которое
    поддерживает одну или более областей применения.</p>

<h2>Классификация по модели данных:</h2>
<ul>
    <li>
        <strong>Иерархическая</strong> - каждый объект может включать в себя несколько объектов более низкого
        уровня.
    </li>
    <li><strong>Объектная и объектно-ориентированная</strong> - данные моделируются в виде объектов, их атрибутов,
        методов и классов (как в ООП).
    </li>
    <li><strong>Объектно-реляционная</strong> - реляционная СУБД (РСУБД), поддерживающая некоторые технологии,
        реализующие объектно-ориентированный подход: объекты, классы и наследование реализованы в структуре баз
        данных и языке запросов.
    </li>
    <li><strong>Реляционная</strong> - хранение данных в виде таблиц, таблицы задают сущности и отношения.</li>
    <li><strong>Сетевая</strong> - логическая модель данных, являющаяся расширением иерархического подхода, строгая
        математическая теория, описывающая структурный аспект, аспект целостности и аспект обработки данных в
        сетевых базах данных. Разница между иерархической моделью данных и сетевой состоит в том, что в
        иерархических структурах запись-потомок должна иметь в точности одного предка, а в сетевой структуре данных
        у потомка может иметься любое число предков.
    </li>
</ul>

<h2>Другая классификация (SQL/NoSQL)</h2>

<p>Поскольку язык SQL является де-факто стандартом для работы с БД, часто используется другая классификация:

</p>

<ul>
    <li>
        <b>SQL</b> -

    </li>
    <li>
        <b>NoSQL</b> - обычно документоорииентированная БД. Или построенная по принципу BigTable
        TODO: раскрыть

    </li>
</ul>

<p>&nbsp;</p>

<h2>Реляционные БД: нормальные формы</h2>

<p><strong>Нормальная форма</strong> - свойство структуры (схемы) реляционной базы данных с точки зрения
    избыточности, потенциально приводящей к логически ошибочным результатам выборки или изменения данных. Нормальная
    форма определяется как совокупность требований, которым должна удовлетворять схема базы данных.</p>

<h3>Первая нормальная форма (1NF)</h3>

<p>Переменная отношения находится в первой нормальной форме (1НФ) тогда и только тогда, когда в любом допустимом
    значении отношения каждый его кортеж содержит только одно значение для каждого из атрибутов.
    В реляционной модели отношение всегда находится в первой нормальной форме по определению понятия отношение. Что
    же касается различных таблиц, то они могут не быть правильными представлениями отношений и, соответственно,
    могут не находиться в 1НФ.</p>

<h3>Вторая нормальная форма (2NF)</h3>

TODO: добавить про остальные

Нужны примеры


<p></p>

<a href="http://ru.wikipedia.org/wiki/%D0%9D%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%84%D0%BE%D1%80%D0%BC%D0%B0">
    http://ru.wikipedia.org/wiki/Нормальная_форма
</a>


<h1>SQL (на примере sqlite), QtSql</h1>

<p><b>SQL (structured query language - «структурированный язык запросов»)</b> - формальный непроцедурный язык
    программирования, применяемый для создания, модификации и управления данными в произвольной реляционной базе
    данных, управляемой соответствующей системой управления базами данных (СУБД).
    SQL основывается на исчислении кортежей.</p>

<p><b>SQLite</b> - компактная встраиваемая реляционная база данных. Исходный код библиотеки передан в общественное
    достояние. В 2005 году проект получил награду Google-O’Reilly Open Source Awards.</p>

<p>Слово «встраиваемый» означает, что SQLite не использует парадигму клиент-сервер, то есть движок SQLite не
    является отдельно работающим процессом, с которым взаимодействует программа, а предоставляет библиотеку, с
    которой программа компонуется и движок SQLite становится составной частью программы. Таким образом, в качестве
    протокола обмена используются вызовы функций (API) библиотеки SQLite. Такой подход уменьшает накладные расходы,
    время отклика и упрощает программу.
    SQLite хранит всю базу данных (включая определения, таблицы, индексы и данные) в единственном стандартном
    файле на том компьютере, на котором исполняется программа. Простота реализации достигается за счёт того, что
    перед началом исполнения транзакции записи весь файл, хранящий базу данных, блокируется.</p>

<p>Сейчас распространены две версии SQLite</p>
<ul>
    <li>2-ая</li>
    <li>3-я sqlite3</li>
</ul>

<p>Несколько процессов или потоков могут одновременно без каких-либо проблем читать данные из одной базы. Запись в
    базу можно осуществить только в том случае, если никаких других запросов в данный момент не обслуживается; в
    противном случае попытка записи оканчивается неудачей, и в программу возвращается код ошибки. Другим вариантом
    развития событий является автоматическое повторение попыток записи в течение заданного интервала времени.</p>

<p>В комплекте поставки идёт также функциональная клиентская часть в виде исполняемого файла <b>sqlite3</b>, с
    помощью которого демонстрируется реализация функций основной библиотеки. Клиентская часть работает из командной
    строки, позволяет обращаться к файлу БД на основе типовых функций ОС.</p>

<p>Благодаря архитектуре движка возможно использовать SQLite как на встраиваемых системах, так и на выделенных
    машинах с гигабайтными массивами данных.</p>

<p><b>Использование:</b> сама библиотека SQLite написана на C; существует большое количество привязок к другим
    языкам программирования, в том числе Delphi, C++, Java, C#, VB.NET, Python, Perl, PHP, Ruby, Haskell, Scheme,
    Smalltalk, Lua и Parser, а также ко многим другим.
    Полный список: <a href="http://www.sqlite.org/cvstrac/wiki?p=SqliteWrappers">http://www.sqlite.org/cvstrac/wiki?p=SqliteWrappers</a>
</p>

<p>Простота и удобство встраивания SQLite привели к тому, что библиотека используется в браузерах, музыкальных
    плеерах и многих других программах.
</p>

<h3>Инструменты для создания и редактирования БД</h3>

<p>Plugin для Firefox: <a href="https://code.google.com/p/sqlite-manager/downloads/list">https://code.google.com/p/sqlite-manager/downloads/list</a>
</p>


<h2>Язык SQL: SELECT, INSERT, UPDATE, DELETE</h2>

<p><b>SQL: DDL + DML + DCL.</b></p>

<p><b>Data Definition Language (DDL) (язык описания данных)</b> - семейство компьютерных языков, используемых в
    компьютерных программах для описания структуры баз данных.</p>

<p><b>Data Manipulation Language (DML) (язык управления/манипулирования данными)</b> - это семейство компьютерных
    языков, используемых в компьютерных программах или пользователями баз данных для получения, вставки, удаления
    или изменения данных в базах данных.</p>

<p><b>Data Control Language (DCL) (управления БД)</b> - подмножество языка управления базами данных SQL,
    предназначенное для осуществления
    административных операций, присваивающих или отменяющих право (привилегию) использовать базу данных, таблицы и
    другие объекты базы данных, а также выполнять те или иные операторы SQL.</p>
<ul>
    <li>GRANT — применяется для присвоения привилегии;</li>
    <li>REVOKE — применяется для отмены привилегии.</li>
</ul>

<h3>SELECT</h3>

<p><b>SELECT (выбрать)</b> - оператор DML языка SQL, возвращающий набор данных (выборку) из базы данных,
    удовлетворяющих заданному условию.</p>

<p>В большинстве случаев, выборка осуществляется из одной или нескольких таблиц. В последнем случае говорят об
    операции
    слияния - JOIN. В тех СУБД, где реализованы представления (view) и хранимые процедуры (stored
    procedure), также возможно получение соответствующих наборов данных.</p>

<p> При формировании запроса SELECT пользователь описывает ожидаемый набор данных: его вид (набор столбцов) и его
    содержимое (критерий попадания записи в набор, группировка значений, порядок вывода записей и т. п.).</p>

<p> Запрос выполняется следующим образом (до оптимизации): сначала извлекаются все записи из таблицы, а затем для
    каждой записи набора проверяется её соответствие заданному критерию. Если осуществляется слияние из нескольких
    таблиц, то сначала составляется произведение таблиц, а уже затем из полученного набора отбираются требуемые
    записи.</p>

<p>Особую роль играет обработка NULL-значений, когда при слиянии, например, двух таблиц — главной (master) и
    подчинённой (detail) — имеются или отсутствуют соответствия между записями таблиц, участвующих в слиянии. Для
    решения этой задачи используются механизмы внутреннего (inner) и внешнего (outer) слияния.</p>

<p> Один и тот же набор данных может быть получен при выполнении различных запросов. Поиск оптимального плана
    выполнения данного запроса является задачей оптимизатора.</p>


<h2>Нормальные формы</h2>

<ul>
    <li>
        TODO: вписать
    </li>
    <li></li>
</ul>

<h2>Plugin для Firefox с поддержкой SQLite</h2>


<h2>Соединение с базой данных (Подключение к Базе Данных). Выполнение инструкций SQL</h2>


<pre class="sh_cpp">
#include &lt;QtSql&gt;

    // -- Подключение к Базе Данных --
    // Подключаем драйвер для работы с SQLite
    cout << "SQLite driver" << endl;
    // Названия драйверов для Qt:
    //   http://qt-project.org/doc/qt-5/sql-driver.html
    QSqlDatabase dbase = QSqlDatabase::addDatabase("QSQLITE");
    // Имя базы данных для SQLite = имя файла базой данных
    dbase.setDatabaseName("my_db.sqlite");
    if (!dbase.open()) {
        qDebug() << "Не получилось открыть/создать файл с базой данных!";
        return -1;
    }
</pre>

<p>Полный список драйверов: <a href="http://qt-project.org/doc/qt-5/sql-driver.html">http://qt-project.org/doc/qt-5/sql-driver.html</a>
</p>

<table border="1">
    <thead>
    <tr></tr>
    </thead>
    <tbody>
    <tr>
        <td></td>
        <td></td>
    </tr>
    </tbody>
</table>

<p>Для MySQL: </p>


<h3>Создание схемы БД</h3>

<pre class="sh_cpp">
// query - SQL-запрос в виде строки
void SQL_Execute(QString query){
    // QSqlQuery a_query(query);
    QSqlQuery q;
    bool res = q.exec(query);
    if (!res) {
        qDebug() << "Cannot execute: " << query;
    }
}
</pre>


<h3>Добавление данных</h3>

<h3>Выполнение запроса и навигация по результирующей выборке</h3>


<h2>Вставка, изменение и удаление записей</h2>

<h2>Транзакции</h2>

<h2>Использование классов-моделей SQL (модель запроса, модель таблицы). Отображение данных в
    таблице-представлении.</h2>


<h2>Сборка Qt-приложений из командной строки</h2>


<p>Сборка выполняется в несколько этапов.
</p>

<h3>qmake</h3>
<ul>
    <li>По файлу проекта <b>.pro</b> генерируем Make-файлы и "генерируемые" исходники (ключевое слово <b>slot</b> и
        другие Qt-специфичные ключевые слова). Делаем с помощью <b>qmake</b>.
        Например: "qmake Qt_SQL.pro". Выполним.. получим:
    </li>
</ul>


<p>Можно для своего удобства написать командный файл <b>q.cmd</b>:</p>
<pre>
set QT_HOME=C:\Qt
set PATH=%QT_HOME%\5.2.1\mingw48_32\bin;%QT_HOME%\Tools\mingw48_32\bin;%PATH%
qmake %1
</pre>

<p>
    <b>%1</b> - это первый параметр командного файла. Т.е. пользоваться мы будем так:
    "q.cmd Qt_SQL.pro"
</p>


<p><b>qmake</b> сгенеририрует 3 make-файла:

</p>

<ul>
    <li>
        <b>Makefile</b> - общий make-файл для Release и Debug-конфигураций
    </li>
    <li><b>Makefile.Debug</b> - специфичная для Debug-версии часть.
    </li>
    <li><b>Makefile.Release</b> - специфичная для Release-версии (для готового продукта) часть Makefile.
        -pipe -fno-keep-inline-dllexport -O2 -Wall -Wextra
    </li>
</ul>


<h3>Makefile.Release</h3>
Специальный DEFINE: -DQT_NO_DEBUG - можно в своих программах писать:
<pre class="sh_cpp">
#ifndef QT_NO_DEBUG
// Часть кода только для отладки, которая в Release версии вообще будет отствовать
    ...
#endif
    </pre>

<h3>LIBS - библиотеки</h3>

<ul>
    <li><b>LIBS = -lQt5Sql<cite>d</cite> -lQt5Core<cite>d</cite></b> - для Debug версии</li>
    <li><b>LIBS = -LC:\Qt\5.2.1\mingw48_32\lib -lQt5Sql -lQt5Core</b> - для Release версии</li>
</ul>


</div>
</body>

</html>
